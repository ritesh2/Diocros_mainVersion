<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>DioCroS</title>
  <script type="text/javascript" src="js/blockly_compressed.js"></script>
  <script type="text/javascript" src="js/blocks_compressed.js"></script>
  <script type="text/javascript" src="js/javascript_compressed.js"></script>
  <script type="text/javascript" src="js/generators/diocros.js"></script>
  <script type="text/javascript" src="js/generators/diocros/logic.js"></script>
  <script type="text/javascript" src="js/generators/diocros/loops.js"></script>
  <script type="text/javascript" src="js/generators/diocros/math.js"></script>
  <script type="text/javascript" src="js/generators/diocros/variables.js"></script>
  <script type="text/javascript" src="js/msg/js/en.js"></script>
  <script type="text/javascript" src="js/diocros.js"></script>

  <style>
    body {
     background: url(img/space.jpg) no-repeat center center fixed; 
	  -webkit-background-size: cover;
	  -moz-background-size: cover;
	  -o-background-size: cover;
	  background-size: cover;
      font-family: sans-serif;
	  }
    
h1{
		color:#FFFFFF;
		font-size:250%;
	}
	.myButton {
	background-color:#87D37C;
	-moz-border-radius:28px;
	-webkit-border-radius:28px;
	border-radius:28px;
	border:1px solid #18ab29;
	display:inline-block;
	cursor:pointer;
	color:#ffffff;
	font-family:arial;
	font-size:17px;
	padding:16px 31px;
	text-decoration:none;
	text-shadow:0px 1px 0px #2f6627;
}
.myButton:hover {
	background-color:#5cbf2a;
}
.myButton:active {
	position:relative;
	top:1px;
}


  </style>
<script type="text/javascript">
    var gui = require('nw.gui');
    var child_process = require('child_process');


	function clr(){
			document.getElementById("output").value= "";
		}	

	function burnCode(){
		
		/*cmd /c bin\\c_and_gen.bat sample*/
		writeSample();
		child_process.execFile('.\\bin\\c_and_gen.bat',['sample'], function(error, stdout, stderr){
				document.getElementById("output").value+= stdout;				                
				document.getElementById("output").value+= stderr;	            
              });
	}


    //var process_node = require('process');
    // Create menu container
    var Menu = new gui.Menu({
        type:   'menubar'
    });
  /*  Menu.createMacBuiltin("DioCroS", {
      hideEdit: true,
      hideWindow: true
    });*/
    // Create new root menu
    var downloadMenu = new gui.Menu();

    // Append new item to downloadMenu
    downloadMenu.append(
        new gui.MenuItem({
            label: 'Download',
            click: function() {
              child_process.exec('cmd /c sample.bat', function(error, stdout, stderr){
                  alert('Platform : '+stderr);
                  // …you callback code may run here…
              });
            }
        })
    );

    // Append downloadMenu to root Menu
    Menu.append(
        new gui.MenuItem({
            label: 'File',
            submenu: downloadMenu
        })
    );

    // Append Menu to Window
    gui.Window.get().menu = Menu;

	function writeSample(){
		var code=Blockly.Diocros.workspaceToCode();
		document.getElementById("output").value=code;				                
		var fs = require('fs');
		fs.writeFile('./workspace/sample.c', code, function (err) {
		if (err) throw err;
		document.getElementById("output").value+= "\nSaved";				                
		});
	}



</script>
</head>
<body>
  <center><h1>DioCroS</h1>

  <button onclick="showCode()" value="ShowCode" class="myButton">ShowCode</button>
  <button onclick="writeSample()" value="Write Code" class="myButton">Save Code</button>
  <button onclick="burnCode()" value="Burn Code" class="myButton">Burn Code</button>
	<button onclick="clr()" value="Clear Console" class="myButton">Clear Console</button>	

  <div id="blocklyDiv" style="height: 500px; width: 800px;"></div>
</center>
  <xml id="toolbox" style="display: none">
    <category name="Diocros">
      <block type="forward"></block>
	  <block type="backward"></block>
	  <block type="wait"></block>
	  <block type="led"></block>
	  <block type="indicator"></block>
	  <block type="buzzer"></block>
	  <block type="sample_block"></block>
     <block type="led_rgb"></block>
	 <block type="main"></block>
	</category>
	<category name="Sensors">
	</category>
    <category name="Logic">
      <category name="If">
        <block type="controls_if"></block>
        <block type="controls_if">
          <mutation else="1"></mutation>
        </block>
        <block type="controls_if">
          <mutation elseif="1" else="1"></mutation>
        </block>
      </category>
      <category name="Boolean">
        <block type="logic_compare"></block>
        <block type="logic_operation"></block>
        <block type="logic_negate"></block>
        <block type="logic_boolean"></block>
        <block type="logic_null"></block>
        <block type="logic_ternary"></block>
      </category>
    </category>
    <category name="Loops">
      <block type="controls_repeat_ext">
        <value name="TIMES">
          <block type="math_number">
            <field name="NUM">10</field>
          </block>
        </value>
      </block>
      <block type="controls_whileUntil"></block>
      <block type="controls_for">
        <field name="VAR">i</field>
        <value name="FROM">
          <block type="math_number">
            <field name="NUM">1</field>
          </block>
        </value>
        <value name="TO">
          <block type="math_number">
            <field name="NUM">10</field>
          </block>
        </value>
        <value name="BY">
          <block type="math_number">
            <field name="NUM">1</field>
          </block>
        </value>
      </block>
      <block type="controls_forEach"></block>
      <block type="controls_flow_statements"></block>
    </category>

      <category name="Math">
      <block type="math_number"></block>
      <block type="math_arithmetic"></block>
      <block type="math_single"></block>
      <block type="math_trig"></block>
      <block type="math_constant"></block>
      <block type="math_number_property"></block>
      <block type="math_change">
        <value name="DELTA">
          <block type="math_number">
            <field name="NUM">1</field>
          </block>
        </value>
      </block>
      <block type="math_round"></block>
      <block type="math_on_list"></block>
      <block type="math_modulo"></block>
      <block type="math_constrain">
        <value name="LOW">
          <block type="math_number">
            <field name="NUM">1</field>
          </block>
        </value>
        <value name="HIGH">
          <block type="math_number">
            <field name="NUM">100</field>
          </block>
        </value>
      </block>
      <block type="math_random_int">
        <value name="FROM">
          <block type="math_number">
            <field name="NUM">1</field>
          </block>
        </value>
        <value name="TO">
          <block type="math_number">
            <field name="NUM">100</field>
          </block>
        </value>
      </block>
      <block type="math_random_float"></block>
    </category>
	<category name="Variables" custom="VARIABLE"></category>
  </xml>

<textarea id='output' rows=20 cols=90></textarea>


  <script>
    Blockly.inject(document.getElementById('blocklyDiv'),
        {toolbox: document.getElementById('toolbox')});
  </script>
  <script type="text/javascript">

		

  		function showCode() {
  			Blockly.Diocros.INFINITE_LOOP_TRAP = null;
		    var code = Blockly.Diocros.workspaceToCode();
		    alert(code);
  		}
  </script>

</body>
<style type="text/css">
  .blocklyToolboxDiv {
    background-color:#88D9B7;
  }
  .blocklySvg {
    background-color:#B2BACB;
  }
</style>
</html>
